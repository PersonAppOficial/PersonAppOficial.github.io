<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>PersonAPP</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
:root{ --bg:#2b2ee6; --text:#f4f6f8; --panel:#202225; --panel2:#151618; --accent:#4CAF50; --muted:#b9c0c7; --warn:#ffd166; }
*{box-sizing:border-box}
body{margin:0; background:var(--bg); color:var(--text); font-family:'Montserrat','Segoe UI',Arial,sans-serif}
a{color:inherit; text-decoration:none}
.wrap{max-width:1200px; margin:0 auto; padding:20px}
header{display:flex; align-items:center; justify-content:center; text-align:center; padding:40px 10px 10px}
h1{font-size:2.4rem; margin:0 0 8px; text-shadow:0 2px 16px rgba(18,255,65,.7)}
p.lead{margin:0; opacity:.9}

/* Grilla Apps */
.grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:22px; margin:32px 0 48px}
.card{background:linear-gradient(135deg,var(--panel2) 60%,var(--panel) 100%); border:1px solid rgba(255,255,255,.06);
border-radius:16px; padding:18px; box-shadow:0 2px 16px rgba(0,0,0,.25); transition:transform .2s, box-shadow .2s;}
.card:hover{transform:translateY(-6px); box-shadow:0 10px 24px rgba(0,0,0,.35)}
.card img.logo{width:64px; height:64px; object-fit:contain; background:#111; border-radius:12px; box-shadow:0 1px 8px rgba(0,0,0,.3)}
.card h3{margin:12px 0 8px; font-size:1.15rem}
.card p{margin:0 0 12px; color:#dfe5ea}
.stores{display:flex; gap:8px; flex-wrap:wrap}
.btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; border:none; cursor:pointer;
background:linear-gradient(90deg,#232526 0%, var(--accent) 100%); color:#fff; font-weight:700; font-size:.9rem}

/* Foro */
#foro{background:rgba(0,0,0,.16); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:20px; margin:24px 0 80px}
#foro h2{margin:0 0 6px}
.hint{color:var(--muted); margin:0 0 16px}
#postForm{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px}
#postForm .full{grid-column:1/-1}
input, select, textarea{width:100%; border:1px solid rgba(255,255,255,.15); background:#141516; color:#fff;
border-radius:10px; padding:10px 12px; font-family:inherit; font-size:1rem}
textarea{min-height:100px; resize:vertical}
.actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.progress{height:8px; background:#111; border-radius:6px; overflow:hidden; width:220px; display:none}
.bar{height:100%; width:0%; background:var(--accent); transition:width .1s linear}
.feed{display:grid; grid-template-columns:repeat(auto-fill,minmax(360px,1fr)); gap:14px}
.post{background:linear-gradient(135deg,#1a1a1a 60%, #232323 100%); border:1px solid rgba(255,255,255,.08);
border-radius:12px; padding:14px; box-shadow:0 1px 10px rgba(0,0,0,.25)}
.meta{font-size:.85rem; color:#c7ced6}
.stars{color:var(--warn)}
.media{margin-top:8px}
.media img, .media video{width:100%; border-radius:10px; display:block}
.toolbar{display:flex; gap:10px; margin-top:8px; align-items:center}
.vote{display:inline-flex; gap:6px; align-items:center}
.vote button{background:#1f2023; color:#fff; border:1px solid #2b2d31; border-radius:8px; padding:4px 8px; cursor:pointer}
.tag{font-size:.85rem; background:#1e1f22; border:1px solid #2b2d31; padding:4px 8px; border-radius:999px}

.comments{margin-top:10px; border-top:1px solid rgba(255,255,255,.08); padding-top:10px}
.comment{font-size:.95rem; margin:6px 0}
.comment .by{color:#cbd2d9; font-size:.85rem}
.comment-form{display:flex; gap:6px; margin-top:8px}
.comment-form input{flex:1}
.comment-form button{white-space:nowrap}

/* Filtros y paginaci√≥n */
.actions-row{display:flex; gap:8px; margin:8px 0 12px; align-items:center; flex-wrap:wrap}
.chip{font-size:.85rem; background:#1e1f22; border:1px solid #2b2d31; padding:4px 8px; border-radius:999px}
.more{display:flex; justify-content:center; margin-top:12px}
.more button{background:#202225; color:#fff; border:1px solid #2b2d31; padding:8px 12px; border-radius:8px; cursor:pointer}

/* Juego estilo Mario */
#juego{margin:50px 0 90px; background:rgba(0,0,0,.14); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:20px}
#gameWrap{display:flex; flex-direction:column; align-items:center; gap:8px}
#mario{background:#0f0f12; border:2px solid #2b2b2b; border-radius:8px; max-width:100%; height:auto}
.hud{display:flex; gap:14px; flex-wrap:wrap; align-items:center; justify-content:center}

/* Fijos */
.brand{position:fixed; left:16px; bottom:16px; font-weight:800; letter-spacing:1px; opacity:.9}
.contact{position:fixed; right:16px; bottom:16px; opacity:.9; background:rgba(0,0,0,.3); padding:6px 12px; border-radius:8px}
</style>
</head>
<body>
<div class="wrap">
<header>
<div>
<h1>APP para emprendedores</h1>
<p class="lead">Apps destacadas ¬∑ Foro tipo reddit (en vivo) ¬∑ Minijuego de plataformas</p>
</div>
</header>

<!-- Apps -->
<section id="apps" class="grid" aria-label="apps">
<article class="card">
<img class="logo" src="Img/logo.busho.png" alt="BUSHO" />
<h3>BUSHO</h3>
<p>Arriendo flexible de espacios comerciales.</p>
<div class="stores">
<a class="btn" href="https://busho.cl/" target="_blank" rel="noopener noreferrer">Visitar</a>
<a class="btn" href="https://apps.apple.com/cl/app/busho/id1665748711" target="_blank" rel="noopener noreferrer">iOS</a>
<a class="btn" href="https://play.google.com/store/apps/details?id=app.busho.cl" target="_blank" rel="noopener noreferrer">Android</a>
</div>
</article>

<article class="card">
<img class="logo" src="Img/logo.canva.png" alt="Canva" />
<h3>Canva</h3>
<p>Dise√±os f√°ciles para redes y marca.</p>
<div class="stores"><a class="btn" href="https://www.canva.com/" target="_blank" rel="noopener noreferrer">Visitar</a></div>
</article>

<article class="card">
<img class="logo" src="Img/logo.shopify3.png" alt="Shopify" />
<h3>Shopify</h3>
<p>Tu tienda online en minutos.</p>
<div class="stores"><a class="btn" href="https://www.shopify.com/" target="_blank" rel="noopener noreferrer">Visitar</a></div>
</article>

<article class="card">
<img class="logo" src="Img/logo.zoom.png" alt="Zoom" />
<h3>Zoom</h3>
<p>Reuniones profesionales.</p>
<div class="stores"><a class="btn" href="https://zoom.us/" target="_blank" rel="noopener noreferrer">Visitar</a></div>
</article>

<article class="card">
<img class="logo" src="Img/logo.mercadopago.png" alt="Mercado Pago" />
<h3>Mercado Pago</h3>
<p>Cobra con tarjeta desde el celular.</p>
<div class="stores"><a class="btn" href="https://www.mercadopago.cl/" target="_blank" rel="noopener noreferrer">Visitar</a></div>
</article>
</section>

<!-- Foro tipo reddit -->
<section id="foro">
<h2>Foro & Rese√±as</h2>
<p class="hint">Publica sobre las apps de arriba (texto, imagen o video). Votos, comentarios y feed en vivo.</p>

<form id="postForm">
<div>
<label>App</label>
<select id="fApp" required>
<option value="BUSHO">BUSHO</option><option value="Canva">Canva</option>
<option value="Shopify">Shopify</option><option value="Zoom">Zoom</option>
<option value="Mercado Pago">Mercado Pago</option>
</select>
</div>
<div><label>Tu nombre</label><input id="fName" type="text" placeholder="Ej: Ra√∫l" required maxlength="40"/></div>
<div class="full"><label>T√≠tulo (opcional)</label><input id="fTitle" type="text" maxlength="100" placeholder="Ej: Mi experiencia inicial" /></div>
<div class="full"><label>Texto</label><textarea id="fText" placeholder="¬øQu√© te gust√≥? ¬øQu√© mejorar√≠as?" required maxlength="1000"></textarea></div>
<div class="full">
<label>Imagen o video (opcional)</label>
<input id="fFile" type="file" accept="image/*,video/*" />
<div class="progress" id="progress"><div class="bar" id="bar"></div></div>
</div>
<div class="full actions">
<button class="btn" type="submit" id="sendBtn">Publicar</button>
<span id="status" class="hint"></span>
</div>
</form>

<div class="actions-row">
<select id="filterApp">
<option value="">Todas las apps</option>
<option value="BUSHO">BUSHO</option><option value="Canva">Canva</option>
<option value="Shopify">Shopify</option><option value="Zoom">Zoom</option>
<option value="Mercado Pago">Mercado Pago</option>
</select>
<select id="orderSel">
<option value="desc">M√°s nuevas primero</option>
<option value="top">Top (votos)</option>
<option value="asc">M√°s antiguas primero</option>
</select>
<span class="chip" id="liveChip">üî¥ En vivo</span>
</div>

<div id="feed" class="feed"></div>
<div class="more"><button id="loadMore" style="display:none">Cargar m√°s</button></div>
</section>

<!-- Minijuego: plataformas (tipo Mario) -->
<section id="juego">
<h2>Minijuego: Salta hasta la bandera</h2>
<p class="hint">Flechas o WASD para moverte. Barra espaciadora para saltar. Junta ‚≠ê y llega a la bandera üéå.</p>
<div id="gameWrap">
<canvas id="mario" width="960" height="480"></canvas>
<div class="hud">
<button class="btn" id="restart">Reiniciar</button>
<div>Nivel: <strong id="lvl">1</strong></div>
<div>Estrellas: <strong id="coins">0</strong></div>
</div>
</div>
</section>
</div>

<div class="brand">PersonAPP</div>
<div class="contact">contacto: personappoficial@gmail.com</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script>
/* üîê Pega aqu√≠ TUS credenciales reales */
const firebaseConfig = {
apiKey: "TU_API_KEY",
authDomain: "TU_AUTH_DOMAIN",
projectId: "TU_PROJECT_ID",
storageBucket: "TU_STORAGE_BUCKET",
messagingSenderId: "TU_SENDER_ID",
appId: "TU_APP_ID"
};
if(!firebaseConfig.apiKey){ alert("Falta configurar Firebase: edita firebaseConfig."); }
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
db.enablePersistence({synchronizeTabs:true}).catch(()=>{});
</script>

<script>
/************ Foro en vivo tipo reddit (p√∫blico) ************/
const allowedApps = ["BUSHO","Canva","Shopify","Zoom","Mercado Pago"];
const $ = s => document.querySelector(s);
const feed = $("#feed"), statusEl=$("#status"), bar=$("#bar"), prog=$("#progress");
const filterApp = $("#filterApp"), orderSel = $("#orderSel"), loadMoreBtn = $("#loadMore"), liveChip=$("#liveChip");
const PAGE = 20;
let lastDoc = null, unsub = null;

const escapeHTML = s => (s||"").replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
const stars = n => "‚òÖ".repeat(+n||0) + "‚òÜ".repeat(5-(+n||0));
const tsToDate = ts => (ts?.toDate ? ts.toDate() : new Date());

function k(m){ return m ?? 0; }

function postCard(doc){
const p = doc.data(); const t = tsToDate(p.time);
const el = document.createElement("article"); el.className="post"; el.id = `post-${doc.id}`;
el.innerHTML = `
<div class="meta"><strong>${escapeHTML(p.app||"")}</strong> ¬∑ ${escapeHTML(p.name||"Invitado")}</div>
${p.title ? `<h3 style="margin:6px 0 6px">${escapeHTML(p.title)}</h3>` : ""}
<div>${escapeHTML(p.text||"")}</div>
<div class="media">
${p.mediaUrl ? (p.mediaType==="video" ? `<video controls src="${escapeHTML(p.mediaUrl)}"></video>` : `<img loading="lazy" src="${escapeHTML(p.mediaUrl)}" alt="media">`) : ""}
</div>
<div class="toolbar">
<span class="vote">
<button data-vote="up" data-id="${doc.id}">‚¨ÜÔ∏è</button>
<strong id="v-${doc.id}">${k(p.votes)}</strong>
<button data-vote="down" data-id="${doc.id}">‚¨áÔ∏è</button>
</span>
<span class="tag">${escapeHTML(p.app||"")}</span>
<span class="meta" style="margin-left:auto">${t.toLocaleString()}</span>
</div>
<div class="comments">
<div class="comment-form">
<input type="text" placeholder="Comentar..." maxlength="300" />
<button class="btn" data-cid="${doc.id}">Comentar</button>
</div>
<div class="comment-list"></div>
</div>
`;
// Votos
el.querySelectorAll("button[data-vote]").forEach(b=>{
b.addEventListener("click", async ()=>{
const id = b.getAttribute("data-id");
const delta = b.getAttribute("data-vote")==="up" ? 1 : -1;
try{
await db.collection("posts").doc(id).update({ votes: firebase.firestore.FieldValue.increment(delta) });
}catch(e){ console.error(e); }
});
});
// Comentarios realtime
const list = el.querySelector(".comment-list");
db.collection("posts").doc(doc.id).collection("comments").orderBy("time","asc")
.onSnapshot(s=>{
list.innerHTML = "";
s.forEach(c=>{
const d=c.data(); const ct=tsToDate(d.time);
const li=document.createElement("div"); li.className="comment";
li.innerHTML = `<div>${escapeHTML(d.text||"")}</div><div class="by">${escapeHTML(d.name||"Invitado")} ¬∑ ${ct.toLocaleString()}</div>`;
list.appendChild(li);
});
});
// Enviar comentario
const [inp,btn]=el.querySelectorAll(".comment-form > *");
btn.addEventListener("click", async ()=>{
const text=inp.value.trim(); if(!text) return;
await db.collection("posts").doc(doc.id).collection("comments").add({
text, name:"Invitado", time: firebase.firestore.FieldValue.serverTimestamp()
});
inp.value="";
});
return el;
}

function stopLive(){ if(unsub){ unsub(); unsub=null; } liveChip.textContent = "üü° Vista est√°tica"; }

function baseQueryServer(){
const dir = orderSel.value;
// Evitamos √≠ndices compuestos obligatorios: por defecto solo ordenamos por time y filtramos en cliente.
// Para "Top", ordenamos por votes desc (y time como desempate).
if(dir==="top"){
return db.collection("posts").orderBy("votes","desc").orderBy("time","desc");
}
if(dir==="asc"){ return db.collection("posts").orderBy("time","asc"); }
return db.collection("posts").orderBy("time","desc");
}

function startLive(){
stopLive();
liveChip.textContent = "üî¥ En vivo";
const q = baseQueryServer().limit(PAGE);
unsub = q.onSnapshot(snap=>{
const selected = (filterApp.value || "").trim();
feed.innerHTML = "";
const frag=document.createDocumentFragment();
snap.forEach(doc=>{
const app = (doc.data().app||"");
if(!selected || selected===app){ frag.appendChild(postCard(doc)); }
});
feed.appendChild(frag);
lastDoc = snap.docs.length ? snap.docs[snap.docs.length-1] : null;
loadMoreBtn.style.display = lastDoc ? "" : "none";
}, async (err)=>{
console.error(err);
stopLive();
// Fallback est√°tico
const snap = await baseQueryServer().limit(PAGE).get();
const selected = (filterApp.value || "").trim();
feed.innerHTML = "";
const frag=document.createDocumentFragment();
snap.forEach(doc=>{
const app = (doc.data().app||"");
if(!selected || selected===app){ frag.appendChild(postCard(doc)); }
});
feed.appendChild(frag);
lastDoc = snap.docs.length ? snap.docs[snap.docs.length-1] : null;
loadMoreBtn.style.display = lastDoc ? "" : "none";
});
}

async function loadMore(){
if(!lastDoc) return;
const q = baseQueryServer().startAfter(lastDoc).limit(PAGE);
const snap = await q.get();
const selected = (filterApp.value || "").trim();
const frag=document.createDocumentFragment();
snap.forEach(doc=>{
const app = (doc.data().app||"");
if(!selected || selected===app){ frag.appendChild(postCard(doc)); }
});
feed.appendChild(frag);
lastDoc = snap.docs.length ? snap.docs[snap.docs.length-1] : null;
loadMoreBtn.style.display = lastDoc ? "" : "none";
}

filterApp.addEventListener("change", startLive);
orderSel.addEventListener("change", startLive);
loadMoreBtn.addEventListener("click", loadMore);

// Subida con progreso (fluida)
async function uploadMedia(file){
if(!file) return { url:"", type:"" };
const MAX_MB = 25;
if(file.size > MAX_MB*1024*1024) throw new Error("Archivo muy grande (m√°x " + MAX_MB + " MB).");
const safe = file.name.replace(/[^a-z0-9.\-_]/gi,"_");
const path = `media/${Date.now()}_${safe}`;
const ref = storage.ref().child(path);
prog.style.display="block";
return await new Promise((resolve, reject)=>{
const t = ref.put(file, {contentType:file.type});
t.on('state_changed', snap=>{
const pct = Math.round((snap.bytesTransferred/snap.totalBytes)*100);
bar.style.width = pct + "%";
}, err=>{
prog.style.display="none"; bar.style.width="0%"; reject(err);
}, async ()=>{
const url = await ref.getDownloadURL();
bar.style.width = "0%"; prog.style.display="none";
resolve({ url, type: file.type.startsWith("video/") ? "video" : "image" });
});
});
}

// Publicar post
document.getElementById("postForm").addEventListener("submit", async e=>{
e.preventDefault();
const btn = document.getElementById("sendBtn"); btn.disabled = true;
statusEl.textContent = "Subiendo...";
try{
const app = document.getElementById("fApp").value;
const name = document.getElementById("fName").value.trim();
const title = document.getElementById("fTitle").value.trim().slice(0,100);
const text = document.getElementById("fText").value.trim();
const file = document.getElementById("fFile").files[0] || null;
if(!allowedApps.includes(app)) throw new Error("App no permitida.");
if(!name || !text) throw new Error("Completa nombre y texto.");

let mediaUrl="", mediaType="";
if(file){ ({url:mediaUrl, type:mediaType} = await uploadMedia(file)); }

await db.collection("posts").add({
app, name:name.slice(0,40), title, text:text.slice(0,1000),
mediaUrl, mediaType,
time: firebase.firestore.FieldValue.serverTimestamp(),
votes: 0
});

e.target.reset();
statusEl.textContent = "Publicado ‚úîÔ∏è";
}catch(err){
console.error(err);
statusEl.textContent = "Error: " + err.message;
}finally{
setTimeout(()=>statusEl.textContent="",1400);
btn.disabled = false;
}
});

// Arranca el feed
startLive();
</script>

<script>
/***************** Minijuego: Plataformas (tipo Mario) ******************/
const C = document.getElementById("mario");
const X = C.getContext("2d");
const lvlEl = document.getElementById("lvl");
const coinsEl = document.getElementById("coins");

let level=1, coins=0, world, player, cameraX=0;

const TILE = 32, GRAV = 0.6, JUMP = -11.5, SPEED = 3.2, FRICTION=0.85;
const KEY = {left:false, right:false, up:false};

const maps = [
// 0: vac√≠o, 1: bloque, 2: moneda, 3: bandera
[
"0000000000000000000000000000000000000000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000000020000000000000000000000000000000000",
"0000000000000000000000000000000000002000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000000000000000000020000000000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000011111000000000000000000000000000000000",
"0000000000000000000000000000000011111100000000000000",
"1111111111111111111111111111111111111111111111111130"
],
[
"0000000000000000000000000020000000000000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000000000000000000000000002000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000011111100000000000000000000000000000000000020000",
"0000000000000000111110000000000000000000000000000000",
"0000000000000000000000000000000000000000000000000000",
"0000000000000000000000011111110000000000000000000000",
"1111111111111111111111111111111111111111111111111130"
]
];

function loadLevel(n){
const raw = maps[(n-1) % maps.length];
return raw.map(row => row.split("").map(ch => parseInt(ch,10)));
}

function reset(){
world = loadLevel(level);
player = { x: 64, y: 0, vx: 0, vy: 0, onGround: false };
coins = 0; coinsEl.textContent = coins;
cameraX = 0; lvlEl.textContent = level;
}

function tileAt(px, py){
const tx = Math.floor(px / TILE);
const ty = Math.floor(py / TILE);
if(ty < 0 || ty >= world.length || tx < 0) return 1; // paredes invisibles
if(tx >= world[0].length) return 3; // m√°s all√°: bandera
return world[ty][tx];
}

function collectIfCoin(px, py){
const tx = Math.floor(px / TILE);
const ty = Math.floor(py / TILE);
if(tx>=0 && tx<world[0].length && ty>=0 && ty<world.length && world[ty][tx]===2){
world[ty][tx]=0; coins++; coinsEl.textContent = coins;
}
}

function physics(){
// controles
if(KEY.left) player.vx -= 0.6;
if(KEY.right) player.vx += 0.6;
player.vx *= FRICTION;

// salto
if(KEY.up && player.onGround){ player.vy = JUMP; player.onGround=false; }

// gravedad
player.vy += GRAV;

// integrar X
let nx = player.x + player.vx;
if(player.vx > 0){
// choque derecha
if(tileAt(nx+16, player.y-16)===1 || tileAt(nx+16, player.y-1)===1){
nx = Math.floor((nx+16)/TILE)*TILE - 16; player.vx = 0;
}
} else if(player.vx < 0){
// choque izquierda
if(tileAt(nx-16, player.y-16)===1 || tileAt(nx-16, player.y-1)===1){
nx = Math.floor((nx-16)/TILE+1)*TILE + 16; player.vx = 0;
}
}
player.x = nx;

// integrar Y
let ny = player.y + player.vy;
if(player.vy > 0){
// suelo
if(tileAt(player.x-10, ny+0)===1 || tileAt(player.x+10, ny+0)===1){
ny = Math.floor(ny/TILE)*TILE; player.vy = 0; player.onGround = true;
} else { player.onGround = false; }
} else if(player.vy < 0){
// techo
if(tileAt(player.x-10, ny-24)===1 || tileAt(player.x+10, ny-24)===1){
ny = Math.floor((ny-24)/TILE+1)*TILE + 24; player.vy = 0;
}
}
player.y = ny;

// recoger monedas
collectIfCoin(player.x, player.y-16);

// caer al vac√≠o ‚Üí reinicio
if(player.y > C.height + 200){ reset(); }

// avanzar c√°mara
cameraX = Math.max(0, Math.floor(player.x - C.width/2));
}

function draw(){
X.fillStyle = "#87ceeb"; // cielo
X.fillRect(0,0,C.width,C.height);

// dibujar mundo
const startTile = Math.floor(cameraX / TILE);
const endTile = startTile + Math.ceil(C.width / TILE) + 2;

for(let y=0;y<world.length;y++){
for(let x=startTile;x<Math.min(endTile, world[0].length);x++){
const t = world[y][x];
const sx = x*TILE - cameraX, sy = y*TILE;
if(t===1){
X.fillStyle="#2b2b2e";
X.fillRect(sx, sy, TILE, TILE);
X.fillStyle="#1d1d21";
X.fillRect(sx, sy+TILE-6, TILE, 6);
} else if(t===2){
X.font = "22px serif"; X.textAlign="center"; X.textBaseline="middle";
X.fillText("‚≠ê", sx+TILE/2, sy+TILE/2);
} else if(t===3){
X.font = "24px serif"; X.textAlign="center"; X.textBaseline="middle";
X.fillText("üéå", sx+TILE/2, sy+TILE/2);
}
}
}

// jugador
X.font = "28px serif";
X.textAlign = "center"; X.textBaseline = "middle";
X.fillText("üß¢", player.x - cameraX, player.y - 16); // ‚Äúmario-like‚Äù gorrita

// si llegamos a la bandera (al final del mapa)
const atEnd = (player.x / TILE) >= (world[0].length-1);
if(atEnd){
level++; lvlEl.textContent = level;
reset();
}
}

function loop(){ physics(); draw(); requestAnimationFrame(loop); }

// Controles
window.addEventListener("keydown", e=>{
const k = e.key.toLowerCase();
if(k==="arrowleft" || k==="a") KEY.left = true;
if(k==="arrowright"|| k==="d") KEY.right = true;
if(k==="arrowup" || k==="w" || k===" ") KEY.up = true;
});
window.addEventListener("keyup", e=>{
const k = e.key.toLowerCase();
if(k==="arrowleft" || k==="a") KEY.left = false;
if(k==="arrowright"|| k==="d") KEY.right = false;
if(k==="arrowup" || k==="w" || k===" ") KEY.up = false;
});

document.getElementById("restart").addEventListener("click", ()=>{ reset(); });

// Start
reset(); loop();
</script>
</body>
</html>

